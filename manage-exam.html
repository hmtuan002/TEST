<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý bài thi - Hệ thống luyện thi Văn học</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="css/styles.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-purple-800">Quản lý bài thi</h1>
            <a href="index.html" class="text-gray-600 hover:text-purple-600">
                <i class="fas fa-home mr-1"></i> Trang chủ
            </a>
        </header>

        <div class="flex flex-wrap mb-6 border-b border-gray-200">
            <button id="tab-my-exams" class="px-4 py-2 font-medium text-purple-600 border-b-2 border-purple-600">Đề thi của bạn</button>
            <button id="tab-my-results" class="px-4 py-2 font-medium text-gray-500 hover:text-purple-600">Bài thi của bạn</button>
        </div>

        <!-- Tab đề thi của bạn -->
        <div id="my-exams-tab" class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Danh sách đề thi</h2>
                <div class="flex space-x-2">
                    <button id="refresh-exams-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-lg">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button id="new-exam-btn" class="bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg font-medium transition">
                        <i class="fas fa-plus mr-1"></i> Tạo đề mới
                    </button>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white rounded-lg overflow-hidden">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tiêu đề</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thời gian</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ngày tạo</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Số người thi</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="exams-list" class="divide-y divide-gray-200">
                        <tr>
                            <td colspan="5" class="px-6 py-4 text-center">Đang tải dữ liệu...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab bài thi của bạn -->
        <div id="my-results-tab" class="bg-white rounded-xl shadow-lg p-6 mb-8 hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Bài thi đã tham gia</h2>
                <button id="refresh-results-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-lg">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white rounded-lg overflow-hidden">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Đề thi</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ngày thi</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Điểm số</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trạng thái</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="results-list" class="divide-y divide-gray-200">
                        <tr>
                            <td colspan="5" class="px-6 py-4 text-center">Đang tải dữ liệu...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Modal xem chi tiết đề thi -->
        <div id="exam-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 id="exam-detail-title" class="text-xl font-bold text-gray-800">Đề thi Ngữ Văn</h3>
                        <button id="close-exam-detail-btn" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <p id="exam-detail-description" class="text-gray-700 mb-2">Mô tả đề thi</p>
                        <p class="text-sm text-gray-500"><strong>Thời gian:</strong> <span id="exam-detail-duration">60 phút</span></p>
                        <p class="text-sm text-gray-500"><strong>Ngày tạo:</strong> <span id="exam-detail-date">01/01/2023</span></p>
                    </div>
                    
                    <div id="exam-detail-questions" class="space-y-6 mb-6">
                        <!-- Nội dung đề thi sẽ hiển thị ở đây -->
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="font-bold text-gray-700 mb-3">Cài đặt đề thi</h4>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="font-medium">Chống gian lận:</p>
                                    <ul class="list-disc list-inside text-sm text-gray-600">
                                        <li id="anti-copy-setting">Chống sao chép: Bật</li>
                                        <li id="anti-tab-setting">Chống chuyển tab: Bật</li>
                                    </ul>
                                </div>
                                <div>
                                    <p class="font-medium">Cài đặt khác:</p>
                                    <ul class="list-disc list-inside text-sm text-gray-600">
                                        <li id="timer-setting">Hiển thị đồng hồ: Bật</li>
                                        <li id="random-setting">Xáo trộn câu hỏi: Tắt</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="font-bold text-gray-700 mb-3">Thống kê</h4>
                        <div class="grid md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="text-sm text-blue-600 font-medium">Tổng số người thi</p>
                                <p id="total-participants" class="text-2xl font-bold">0</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <p class="text-sm text-green-600 font-medium">Điểm trung bình</p>
                                <p id="average-score" class="text-2xl font-bold">0.0</p>
                            </div>
                            <div class="bg-amber-50 p-4 rounded-lg">
                                <p class="text-sm text-amber-600 font-medium">Điểm cao nhất</p>
                                <p id="highest-score" class="text-2xl font-bold">0.0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="font-bold text-gray-700 mb-3">Danh sách bài thi</h4>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white rounded-lg overflow-hidden">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tên thí sinh</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ngày thi</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Điểm số</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trạng thái</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hành động</th>
                                    </tr>
                                </thead>
                                <tbody id="exam-participants" class="divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="5" class="px-4 py-4 text-center">Đang tải dữ liệu...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-3">
                        <button id="close-exam-modal-btn" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg font-medium transition">
                            Đóng
                        </button>
                        <button id="share-exam-modal-btn" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg font-medium transition">
                            <i class="fas fa-share-alt mr-1"></i> Chia sẻ
                        </button>
                        <button id="delete-exam-modal-btn" class="bg-red-600 hover:bg-red-700 text-white py-2 px-6 rounded-lg font-medium transition">
                            <i class="fas fa-trash-alt mr-1"></i> Xóa đề
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal chấm bài -->
        <div id="grade-exam-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 id="grade-exam-title" class="text-xl font-bold text-gray-800">Chấm bài thi</h3>
                        <button id="close-grade-exam-btn" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <p class="text-gray-700"><strong>Thí sinh:</strong> <span id="grade-student-name">Nguyễn Văn A</span></p>
                        <p class="text-gray-700"><strong>Ngày thi:</strong> <span id="grade-exam-date">01/01/2023</span></p>
                    </div>
                    
                    <div id="grade-exam-questions" class="space-y-6 mb-6">
                        <!-- Nội dung bài thi sẽ hiển thị ở đây -->
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="font-bold text-gray-700 mb-3">Chấm điểm</h4>
                        <div class="grid md:grid-cols-3 gap-6">
                            <div class="bg-white border rounded-lg p-4">
                                <h5 class="font-medium text-gray-700 mb-2">Chấm điểm bằng AI</h5>
                                <p class="text-sm text-gray-600 mb-3">AI sẽ tự động chấm điểm và đưa ra nhận xét.</p>
                                <button id="grade-ai-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition">
                                    <i class="fas fa-robot mr-1"></i> Chấm tự động
                                </button>
                            </div>
                            
                            <div class="bg-white border rounded-lg p-4">
                                <h5 class="font-medium text-gray-700 mb-2">AI hỗ trợ chấm</h5>
                                <p class="text-sm text-gray-600 mb-3">AI sẽ đánh dấu các phần tốt/chưa tốt để hỗ trợ bạn chấm.</p>
                                <button id="grade-assist-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg font-medium transition">
                                    <i class="fas fa-magic mr-1"></i> Hỗ trợ chấm
                                </button>
                            </div>
                            
                            <div class="bg-white border rounded-lg p-4">
                                <h5 class="font-medium text-gray-700 mb-2">Chấm thủ công</h5>
                                <div class="mb-3">
                                    <label class="block text-sm text-gray-600 mb-1">Tổng điểm</label>
                                    <input type="number" id="manual-grade" class="w-full px-3 py-1 border rounded" min="0" step="0.1">
                                </div>
                                <button id="grade-manual-btn" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-medium transition">
                                    <i class="fas fa-check mr-1"></i> Xác nhận
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="ai-feedback-container" class="mt-6 hidden">
                        <h4 class="font-bold text-gray-700 mb-3">Nhận xét từ AI</h4>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div id="ai-feedback-content"></div>
                            <div class="mt-3 flex justify-end">
                                <button id="apply-ai-grade-btn" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition">
                                    Áp dụng điểm này
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-3">
                        <button id="cancel-grade-btn" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg font-medium transition">
                            Hủy bỏ
                        </button>
                        <button id="save-grade-btn" class="bg-green-600 hover:bg-green-700 text-white py-2 px-6 rounded-lg font-medium transition">
                            <i class="fas fa-save mr-1"></i> Lưu điểm
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal xem bài thi -->
        <div id="view-exam-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 id="view-exam-title" class="text-xl font-bold text-gray-800">Bài thi của <span id="view-student-name">Nguyễn Văn A</span></h3>
                        <button id="close-view-exam-btn" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <p class="text-gray-700"><strong>Đề thi:</strong> <span id="view-exam-name">Đề thi Ngữ Văn</span></p>
                        <p class="text-gray-700"><strong>Ngày thi:</strong> <span id="view-exam-date">01/01/2023</span></p>
                        <p class="text-gray-700"><strong>Điểm số:</strong> <span id="view-exam-score" class="font-bold">8.5/10</span></p>
                    </div>
                    
                    <div id="view-exam-questions" class="space-y-6 mb-6">
                        <!-- Nội dung bài thi sẽ hiển thị ở đây -->
                    </div>
                    
                    <div id="view-exam-feedback" class="bg-blue-50 p-4 rounded-lg mb-6">
                        <h4 class="font-bold text-blue-700 mb-2">Nhận xét</h4>
                        <div id="view-feedback-content"></div>
                    </div>
                    
                    <div class="flex justify-end">
                        <button id="close-view-modal-btn" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg font-medium transition">
                            Đóng
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal chia sẻ -->
        <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl shadow-xl w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">Chia sẻ đề thi</h3>
                        <button id="close-share-btn" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 font-medium mb-2">Liên kết tham gia</label>
                        <div class="flex">
                            <input type="text" id="share-exam-link" class="flex-1 px-4 py-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500" readonly>
                            <button id="copy-share-link-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-r-lg transition">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 font-medium mb-2">Mã QR tham gia</label>
                        <div id="share-qr-code" class="p-2 bg-white rounded border border-gray-200 flex justify-center">
                            <!-- QR code sẽ được tạo ở đây -->
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <a id="share-fb-btn" href="#" class="flex-1 bg-blue-800 hover:bg-blue-900 text-white py-2 px-4 rounded-lg text-center transition">
                            <i class="fab fa-facebook-f mr-1"></i> Facebook
                        </a>
                        <a id="share-zalo-btn" href="#" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg text-center transition">
                            <i class="fab fa-zalo mr-1"></i> Zalo
                        </a>
                    </div>
                    
                    <div class="mt-6 flex justify-end">
                        <button id="close-share-modal-btn" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg font-medium transition">
                            Đóng
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/firebase.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/manage-exam.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</body>
</html>